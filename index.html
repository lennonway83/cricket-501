<!DOCTYPE html>
<html>
<head>
  <title>Cricket 501</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
    .container { max-width: 500px; margin: auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.2); }
    input, button, select { padding: 10px; margin: 5px 0; width: 100%; font-size: 16px; border-radius: 5px; border: 1px solid #ccc; }
    #scoreDisplay { font-size: 28px; margin: 20px 0; text-align: center; }
    #log { max-height: 200px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; background: #fafafa; }
    #log div { margin-bottom: 5px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Cricket 501</h1>
    <input type="text" id="playerInput" placeholder="Enter player name">

    <!-- Dropdown to select stat -->
    <select id="statSelect">
      <option value="runs" selected>Runs</option>
      <option value="high_score">High Score</option>
      <option value="wickets">Wickets</option>
    </select>

    <button onclick="submitTurn()">Play Turn</button>

    <div id="scoreDisplay">Current Score: 501</div>
    <div id="log"></div>
  </div>

  <script>
    // ----- GLOBAL VARIABLES -----
    let playersData = [];
    const impossibleScores = [163, 166, 169, 172, 173, 175, 176, 178, 179];
    let currentScore = 501;

    // ----- LOAD PLAYERS.JSON FROM SAME FOLDER -----
    fetch("players.json")
      .then(response => response.json())
      .then(data => {
        playersData = data;
        console.log("Players loaded:", playersData.length);
      })
      .catch(error => console.error("Failed to load players:", error));

    // ----- HELPER FUNCTIONS -----
    function getPlayerStatsByName(name) {
      name = name.toLowerCase().trim();
      for (let p of playersData) {
        if (p.career && p.career.data) {
          if (p.name.toLowerCase() === name) {
            return p.career.data;
          }
        }
      }
      return null;
    }

    function calculateDartScore(playerName, format="ODI") {
      let stats = getPlayerStatsByName(playerName);
      if (!stats) return 0;

      let stat = stats.find(s => s.type === format);
      if (!stat) return 0;

      const selectedStat = document.getElementById("statSelect").value;

      let score = 0;
      if (selectedStat === "runs") {
        score = stat.runs || 0;
      } else if (selectedStat === "high_score") {
        score = stat.high_score || 0;
      } else if (selectedStat === "wickets") {
        score = stat.wickets || 0;
      }

      // Apply darts rules
      if (score > 180 || impossibleScores.includes(score)) {
        return 0;
      }

      return score;
    }

    function updateLog(message) {
      const log = document.getElementById("log");
      const entry = document.createElement("div");
      entry.textContent = message;
      log.appendChild(entry);
      log.scrollTop = log.scrollHeight;
    }

    // ----- GAME TURN -----
    function submitTurn() {
      const input = document.getElementById("playerInput");
      const playerName = input.value;
      if (!playerName) return alert("Please enter a player name.");

      const scoreThisTurn = calculateDartScore(playerName);
      currentScore -= scoreThisTurn;

      document.getElementById("scoreDisplay").innerText = "Current Score: " + currentScore;
      updateLog(`${playerName} scored ${scoreThisTurn}. Remaining: ${currentScore}`);

      input.value = "";

      // ----- CHECK WIN -----
      if (currentScore <= 0 && currentScore >= -10) {
        alert(`${playerName} wins! Final score: ${currentScore}`);
        currentScore = 501;
        document.getElementById("scoreDisplay").innerText = "Current Score: " + currentScore;
        document.getElementById("log").innerHTML = "";
      }
    }
  </script>
</body>
</html>

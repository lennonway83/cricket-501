<!DOCTYPE html>
<html>
<head>
  <title>Cricket 501 Game</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input, button { padding: 8px; margin: 5px; font-size: 16px; }
    #score { font-size: 24px; margin-top: 20px; }
    #log { margin-top: 20px; max-height: 300px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; }
  </style>
</head>
<body>
  <h1>Cricket 501</h1>
  
  <input type="text" id="playerInput" placeholder="Enter player name">
  <button onclick="playTurn()">Play Turn</button>

  <div id="score">Current Score: 501</div>
  <div id="log"></div>

  <script>
    // Global variables
    let playersData = [];
    let currentScore = 501;
    const impossibleScores = [163, 166, 169, 172, 173, 175, 176, 178, 179];

    // Load players.json from GitHub raw URL
    fetch("https://raw.githubusercontent.com/lennonway83/cricket501/main/players.json")
      .then(response => response.json())
      .then(data => {
        playersData = data;
        console.log("Players loaded:", playersData.length);
      })
      .catch(error => console.error("Failed to load players:", error));

    // Get player stats by name
    function getPlayerStatsByName(name) {
      name = name.toLowerCase().trim();
      for (let p of playersData) {
        if (p.career && p.career.data) {
          if (p.name.toLowerCase() === name) {
            return p.career.data;
          }
        }
      }
      return null;
    }

    // Calculate darts score based on player stats
    function calculateDartScore(playerName, format="ODI") {
      let stats = getPlayerStatsByName(playerName);
      if (!stats) return 0;

      let stat = stats.find(s => s.type === format);
      if (!stat) return 0;

      let score = stat.runs || 0;

      if (score > 180 || impossibleScores.includes(score)) {
        return 0;
      }

      return score;
    }

    // Play a turn
    function playTurn() {
      const input = document.getElementById("playerInput");
      const playerName = input.value;
      if (!playerName) return alert("Enter a player name!");

      const scoreThisTurn = calculateDartScore(playerName);

      currentScore -= scoreThisTurn;

      const log = document.getElementById("log");
      log.innerHTML += `<div>${playerName} scored ${scoreThisTurn}. Remaining score: ${currentScore}</div>`;
      log.scrollTop = log.scrollHeight;

      document.getElementById("score").innerText = "Current Score: " + currentScore;

      input.value = "";

      // Check win condition
      if (currentScore <= 0 && currentScore >= -10) {
        alert(`Game Over! ${playerName} wins with final score ${currentScore}`);
        currentScore = 501; // reset for new game
        log.innerHTML = "";
        document.getElementById("score").innerText = "Current Score: " + currentScore;
      }
    }
  </script>
</body>
</html>     

<!DOCTYPE html>
<html>
<head>
  <title>Cricket 501 - 2 Players</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #2ecc71; color: #fff; }
    .container { max-width: 500px; margin: auto; background: #27ae60; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.3); }
    input, button, select { padding: 10px; margin: 5px 0; width: 100%; font-size: 16px; border-radius: 5px; border: 1px solid #fff; background: #27ae60; color: #fff; }
    #autocomplete-list { background: #fff; color: #000; max-height: 150px; overflow-y: auto; border: 1px solid #ccc; border-radius: 5px; margin-top: -5px; }
    #autocomplete-list div { padding: 5px; cursor: pointer; }
    #autocomplete-list div:hover { background: #ddd; }
    #scoreDisplay { font-size: 28px; margin: 20px 0; text-align: center; }
    #log { max-height: 200px; overflow-y: scroll; border: 1px solid #fff; padding: 10px; background: #2ecc71; }
    #log div { margin-bottom: 5px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Cricket 501 - 2 Players</h1>

    <input type="text" id="playerInput" placeholder="Type player name">
    <div id="autocomplete-list"></div>

    <select id="statSelect">
      <option value="runs" selected>Runs</option>
      <option value="high_score">High Score</option>
      <option value="wickets">Wickets</option>
    </select>

    <button onclick="submitTurn()">Play Turn</button>

    <div id="scoreDisplay">Player 1: 501 | Player 2: 501</div>
    <div id="log"></div>
  </div>

  <script>
    let playersData = [];
    const impossibleScores = [163, 166, 169, 172, 173, 175, 176, 178, 179];
    let scores = [501, 501];
    let turn = 0;

    // Load JSON
    fetch("players.json")
      .then(response => response.json())
      .then(data => {
        playersData = data;
        console.log("Players loaded:", playersData.length);
      })
      .catch(error => console.error("Failed to load players:", error));

    function getPlayerStatsByName(name) {
      name = name.toLowerCase().trim();
      for (let p of playersData) {
        if (p.career && p.career.data) {
          if (p.name.toLowerCase() === name) return p.career.data;
        }
      }
      return null;
    }

    function calculateDartScore(playerName, format="ODI") {
      let stats = getPlayerStatsByName(playerName);
      if (!stats) return 0;
      let stat = stats.find(s => s.type === format);
      if (!stat) return 0;

      const selectedStat = document.getElementById("statSelect").value;
      let score = 0;
      if (selectedStat === "runs") score = stat.runs || 0;
      if (selectedStat === "high_score") score = stat.high_score || 0;
      if (selectedStat === "wickets") score = stat.wickets || 0;

      if (score > 180 || impossibleScores.includes(score)) return 0;
      return score;
    }

    function updateLog(message) {
      const log = document.getElementById("log");
      const entry = document.createElement("div");
      entry.textContent = message;
      log.appendChild(entry);
      log.scrollTop = log.scrollHeight;
    }

    function submitTurn() {
      const playerInput = document.getElementById("playerInput");
      const playerName = playerInput.value;
      if (!playerName) return alert("Please select a player.");

      const scoreThisTurn = calculateDartScore(playerName);
      scores[turn] -= scoreThisTurn;

      updateLog(`Player ${turn+1} (${playerName}) scored ${scoreThisTurn}. Remaining: ${scores[turn]}`);

      document.getElementById("scoreDisplay").innerText = `Player 1: ${scores[0]} | Player 2: ${scores[1]}`;

      playerInput.value = "";
      document.getElementById("autocomplete-list").innerHTML = "";
      turn = 1 - turn;

      if (scores[1-turn] <= 0 && scores[1-turn] >= -10) {
        alert(`Player ${1-turn + 1} wins!`);
        scores = [501, 501];
        document.getElementById("scoreDisplay").innerText = `Player 1: 501 | Player 2: 501`;
        document.getElementById("log").innerHTML = "";
        turn = 0;
      }
    }

    // Autocomplete function
    const playerInput = document.getElementById("playerInput");
    playerInput.addEventListener("input", function() {
      const val = this.value.toLowerCase();
      const list = document.getElementById("autocomplete-list");
      list.innerHTML = "";
      if (val.length < 2) return;

      playersData.forEach(p => {
        if (p.name.toLowerCase().includes(val)) {
          const item = document.createElement("div");
          item.textContent = p.name;
          item.onclick = () => {
            playerInput.value = p.name;
            list.innerHTML = "";
          };
          list.appendChild(item);
        }
      });
    });
  </script>
</body>
</html>

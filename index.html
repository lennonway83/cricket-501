<script>
  // ---------- Player stats container ----------
  let playersData = [];

  // ---------- Game variables ----------
  let scores = [501, 501];
  let currentPlayer = 0;
  const impossibleScores = [163,166,169,172,173,175,176,178,179];

  // ---------- Logging function ----------
  function log(message) {
    const logDiv = document.getElementById('log');
    logDiv.innerHTML += `<div>${message}</div>`;
    logDiv.scrollTop = logDiv.scrollHeight;
  }

  // ---------- Load player stats from local JSON ----------
  async function loadPlayersData() {
    try {
      const response = await fetch('players.json');
      playersData = await response.json();
      log("Player stats loaded!");
    } catch (error) {
      console.error("Failed to load player stats!", error);
      log("Failed to load player stats!");
    }
  }
  loadPlayersData();

  // ---------- Get a player's stat ----------
  function getPlayerStat(playerName, category) {
    const player = playersData.find(p => p.name.toLowerCase() === playerName.toLowerCase());
    if (!player) return 0;

    let score = player[category] || 0;

    // Apply darts rules
    if (score > 180 || impossibleScores.includes(score)) {
      return 0;
    }

    return score;
  }

  // ---------- Start a new turn ----------
  function newTurn() {
    document.getElementById('answerInput').value = '';
    document.getElementById('categorySelect').disabled = false;
    log(`Player ${currentPlayer + 1}'s turn started.`);
  }

  // ---------- Submit player answer ----------
  function submitAnswer() {
    const playerName = document.getElementById('answerInput').value.trim();
    const category = document.getElementById('categorySelect').value;

    if (!playerName) return alert("Enter a player name");

    const score = getPlayerStat(playerName, category);

    scores[currentPlayer] -= score;
    document.getElementById(`score${currentPlayer + 1}`).innerText = scores[currentPlayer];

    log(`Player ${currentPlayer + 1} answered ${playerName} (${category}) â†’ Score: ${score}`);

    if (scores[currentPlayer] <= 0 && scores[currentPlayer] >= -10) {
      checkWin();
      return;
    }

    switchPlayer();
  }

  // ---------- Switch players ----------
  function switchPlayer() {
    document.getElementById(`p${currentPlayer + 1}`).classList.remove('active');
    currentPlayer = (currentPlayer + 1) % 2;
    document.getElementById(`p${currentPlayer + 1}`).classList.add('active');
    log(`Now Player ${currentPlayer + 1}'s turn.`);
  }

  // ---------- Check for a winner ----------
  function checkWin() {
    log(`ðŸŽ‰ Player ${currentPlayer + 1} is in the winning zone! (${scores[currentPlayer]})`);
    alert(`Player ${currentPlayer + 1} wins with ${scores[currentPlayer]}!`);
  }
</script>
